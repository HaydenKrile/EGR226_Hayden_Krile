/**************************************************************************************
* Author:      Hayden Krile
* Course:      EGR 226 - 905
* Date:        02/16/2021
* Project:     Lab4Part2
* File:        main.c
* Description: This program connects to the MSP432 and cycles through red,
*                   green, and blue on the RGB LED. If the user pushes and
*                   holds the on-board button, the LED will hold on the
*                   the button and prevents the debounce from altering the input from the user
***************************************************************************************/

#include "msp.h"

uint8_t DebounceSwitch1();
int pause();

void main(void)
{
	WDT_A->CTL = WDT_A_CTL_PW | WDT_A_CTL_HOLD;		// stop watchdog timer

	//sets P1.1 to a GPIO
    P1->SEL1 &= ~BIT1;
    P1->SEL0 &= ~BIT1;
    //sets P1.1 to input
    P1->DIR &= ~BIT1;
    //the internal resistor is enabled
    P1->REN |= BIT1;
    // sets the resistor as a pull up resistor
    P1->OUT |= BIT1;
    //sets the LED's as outputs
    P2->DIR |= BIT0;
    P2->DIR |= BIT1;
    P2->DIR |= BIT2;

    //creates the switch statement varibale and set the initial state to red
    char lightColor = 'R';
    //variable is used to deal with switch debounce
    int debouncing = 0;
    //variable used to detect when the button is being held down
    int holdButton;

    while (1){
        debouncing = DebounceSwitch1();
        switch(lightColor){

        case 'R':
            if((P1IN & BIT1) == 0){
                P2->OUT |= BIT0;
                holdButton = pause();
            }
        }

    }
}

/*-----------------------------------------------------------
* Function: DebounceSwitch1
* Description: Checks to see if switch 1 was pressed, and delays the read and checks again
                to account for debounce. If the function detects a valid press, the
                program returns as true.
* Inputs:
*              N/A
*
* Outputs:
*              N/A
*---------------------------------------------------------*/
uint8_t DebounceSwitch1(){

    static uint16_t buttonValue = 0;

    buttonValue = ((P1IN & BIT1) / BIT1) | (buttonValue<<1) | 0xF800;
    //small delay to account for debounce
    __delay_cycles(100);

    //return true of the button was pressed
    if(buttonValue == 0xFC00){
        return 1;
    }

    //return 0 of the button was not pressed
    else{
        return 0;
    }
}

int pause(){

    int i;

    for(i = 0; i <= 500; i++){

        if(P1IN & BIT1){
            return 1;
        }
        __delay_cycles(1500);
    }

    return 0;

}
